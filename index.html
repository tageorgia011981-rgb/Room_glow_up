<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Room Glow Up</title>
<link href="https://fonts.googleapis.com/css2?family=Limelight&family=Bad+Script&family=Special+Elite&display=swap" rel="stylesheet">
<style>
/* ---------------- BASE ---------------- */
* { box-sizing: border-box; }

body {
  margin: 0; padding: 0;
  min-height: 100vh; width: 100vw;
  display: flex; flex-direction: row; /* SIDEBAR LAYOUT */
  background: url('background1.jpg') no-repeat center center fixed;
  background-size: cover;
  font-family: 'Special Elite', cursive;
  color: white;
  overflow: hidden; /* Prevent scrolling, everything is contained */
  user-select: none;
}

/* ---------------- SIDEBAR CONTAINER ---------------- */
/* This holds both the Cabinet and the Trunk */
#sidebar-container {
  position: relative;
  width: 350px;
  height: 100vh;
  z-index: 50;
  flex-shrink: 0; /* Never shrink */
}

/* ---------------- CABINET (The Room Selector) ---------------- */
#cabinet-panel {
  position: absolute; top: 0; left: 0;
  width: 100%; height: 100%;
  transition: transform 0.8s ease-in-out;
  /* Cabinet styling */
  display: flex; flex-direction: column; justify-content: center; align-items: center;
}
/* If the cabinet image is transparent, we rely on the img tag. 
   If you want a background color behind the cabinet, add it here. */

#cabinet-img {
  position: absolute; top: 0; left: 0;
  width: 100%; height: 100%; 
  object-fit: fill; 
  filter: drop-shadow(5px 0 10px rgba(0,0,0,0.5));
  z-index: 1;
}

/* Cabinet Drawers (Click Zones) */
.cabinet-drawer-zone {
  position: absolute; left: 10%; width: 80%; height: 15%;
  z-index: 10; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
}
/* Positioning the click zones over the image */
#zone-living { top: 5%; }
#zone-bed    { top: 22%; }
#zone-dining { top: 39%; }
#zone-extra  { top: 56%; }
#zone-upload { top: 73%; }

/* Drawer Labels (Pop out on hover) */
.pop-out-label {
  width: 200px; height: 60px;
  background: linear-gradient(135deg, #8a6e4b 0%, #59442e 50%, #3e2b19 100%);
  border: 2px solid #2a1d12;
  box-shadow: 0 10px 20px rgba(0,0,0,0.6);
  display: flex; align-items: center; justify-content: center;
  opacity: 0; transform: scale(0.8) translateX(-20px); 
  transition: all 0.3s; pointer-events: none;
}
.cabinet-drawer-zone:hover .pop-out-label { opacity: 1; transform: scale(1) translateX(0); }

/* ---------------- TRUNK (The Furniture Selector) ---------------- */
#trunk-panel {
  position: absolute; top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.8); /* Dark backing */
  transform: translateX(-100%); /* Hidden to the LEFT initially */
  transition: transform 0.8s ease-in-out;
  display: flex; flex-direction: column; align-items: center;
  padding-top: 20px;
  z-index: 20;
}

#trunk-bg-img {
  position: absolute; bottom: 0; left: 0; width: 100%; height: 50%;
  object-fit: contain; object-position: bottom;
  z-index: 1; opacity: 0.8;
}

/* The Vertical Stack of Bronze Plates */
#trunk-items-container {
  position: relative; z-index: 10;
  width: 100%; height: 100%;
  overflow-y: auto;
  display: flex; flex-direction: column; align-items: center; gap: 15px;
  padding-bottom: 100px; /* Space for the trunk image at bottom */
}

/* BRONZE PLATE STYLE (Replaces Files) */
.bronze-plate {
  width: 240px; height: 70px;
  background: linear-gradient(135deg, #8a6e4b 0%, #59442e 50%, #3e2b19 100%);
  border: 3px solid #4a3b2a;
  box-shadow: inset 0 0 0 1px #a88860, 0 5px 15px rgba(0,0,0,0.5);
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; transition: all 0.2s;
  position: relative;
}
.bronze-plate:hover {
  transform: scale(1.05); filter: brightness(1.2);
  box-shadow: 0 0 15px #ffd700; /* Gold Glow */
}
.bronze-plate.active {
  border-color: #ffd700;
  background: linear-gradient(135deg, #a88860 0%, #8a6e4b 100%);
}

.plate-icon { width: 40px; height: 40px; object-fit: contain; }

/* ---------------- FLY-OUT MENU (Stacked to the Side) ---------------- */
#flyout-menu {
  position: absolute; top: 20px; left: 340px; /* Just to the right of trunk */
  width: 200px;
  display: flex; flex-direction: column; gap: 10px;
  pointer-events: none; opacity: 0;
  transition: opacity 0.3s, transform 0.3s;
  transform: translateX(-20px);
  z-index: 40;
}
#flyout-menu.visible {
  pointer-events: auto; opacity: 1; transform: translateX(0);
}

.flyout-item {
  width: 100%; height: 60px;
  background: rgba(0, 0, 0, 0.9);
  border: 2px solid #8a6e4b;
  color: #d4af37;
  display: flex; align-items: center; justify-content: flex-start;
  padding-left: 15px; gap: 10px;
  cursor: grab;
  box-shadow: 5px 5px 15px rgba(0,0,0,0.5);
  transition: transform 0.2s;
}
.flyout-item:hover { transform: translateX(10px); background: #2a1d12; }
.flyout-thumb { width: 40px; height: 40px; object-fit: contain; border: 1px solid #555; }

/* ---------------- MAIN STAGE (Widescreen) ---------------- */
#main-stage-area {
  flex-grow: 1; /* Takes remaining width */
  height: 100vh;
  position: relative;
  overflow: hidden;
  background: rgba(0,0,0,0.5);
  border-left: 5px solid #2a1d12;
}

#room-display {
  width: 100%; height: 100%; object-fit: cover;
  cursor: pointer; /* Hand icon to indicate clickable */
}

/* Items on stage */
.stage-item-wrapper {
  position: absolute; cursor: move; display: inline-block;
  z-index: 100;
}
.stage-item-wrapper img { width: 100%; height: 100%; display: block; pointer-events: none; }
.stage-item-wrapper.selected { border: 2px dashed #9932CC; }
.resize-handle {
  width: 15px; height: 15px; background: #9932CC;
  position: absolute; bottom: -5px; right: -5px;
  cursor: se-resize; display: none; border-radius: 50%;
}
.stage-item-wrapper.selected .resize-handle { display: block; }

/* ---------------- STATE CLASSES ---------------- */
/* When Furniture Mode is Active: */
/* 1. Cabinet moves Left (Out) */
body.mode-furniture #cabinet-panel { transform: translateX(-100%); }
/* 2. Trunk moves Right (In) - to 0 */
body.mode-furniture #trunk-panel { transform: translateX(0); }

/* Header adjustments for layout */
.header-overlay {
  position: absolute; top: 10px; right: 20px; text-align: right; z-index: 60; pointer-events: none;
}
h1 { font-family: 'Limelight'; font-size: 2rem; margin: 0; text-shadow: 2px 2px 5px black; }
h2 { font-family: 'Bad Script'; font-size: 1.2rem; margin: 0; }

</style>
</head>
<body>

<div class="header-overlay">
  <h1>Room Glow Up</h1>
  <h2>Design Mode</h2>
</div>

<div id="sidebar-container">
    
    <div id="cabinet-panel">
        <img id="cabinet-img" src="cabinet.png" alt="Cabinet">
        
        <div id="zone-living" class="cabinet-drawer-zone" onmouseenter="hoverRoom('livingroom')" onclick="nextVariation('livingroom')">
            <div class="pop-out-label"><div class="plate-style">Living Room</div></div>
        </div>
        <div id="zone-bed" class="cabinet-drawer-zone" onmouseenter="hoverRoom('bedroom')" onclick="nextVariation('bedroom')">
            <div class="pop-out-label"><div class="plate-style">Bedroom</div></div>
        </div>
        <div id="zone-dining" class="cabinet-drawer-zone" onmouseenter="hoverRoom('diningroom')" onclick="nextVariation('diningroom')">
            <div class="pop-out-label"><div class="plate-style">Dining Room</div></div>
        </div>
        <div id="zone-extra" class="cabinet-drawer-zone" onmouseenter="hoverRoom('extrarooms')" onclick="nextVariation('extrarooms')">
            <div class="pop-out-label"><div class="plate-style">Extra Rooms</div></div>
        </div>
        <div id="zone-upload" class="cabinet-drawer-zone" onclick="triggerUpload()">
            <div class="pop-out-label"><div class="plate-style">Upload</div></div>
        </div>
    </div>

    <div id="trunk-panel">
        <div id="trunk-items-container">
            </div>
        <img id="trunk-bg-img" src="filefolderbox.png" alt="Trunk">
    </div>

    <div id="flyout-menu">
        </div>

</div>

<div id="main-stage-area">
    <img id="room-display" src="" alt="Select a Room" onclick="lockRoom()">
</div>

<input type="file" id="file-upload" accept="image/*" onchange="handleFileUpload(event)" style="display:none">

<script>
/* --- DATA --- */
// Categories (Level 1)
const categories = [
    { id: 'seat', name: 'Seating', icon: 'iconseating.png' },
    { id: 'table', name: 'Tables', icon: 'icontables.png' },
    { id: 'store', name: 'Storage', icon: 'iconstorage.png' },
    { id: 'bed', name: 'Beds', icon: 'iconbeds.png' }
];

// Items (Level 2/3 Flat List for Demo)
const inventory = {
    seat: [
        { name: 'Leather Sofa', image: 'couch1.png' },
        { name: 'Velvet Chair', image: 'couch2.png' },
        { name: 'Wingback', image: 'armchair1.png' },
        { name: 'Stool', image: 'iconstool.png' }
    ],
    table: [
        { name: 'Dining Table', image: 'icondiningtable.png' },
        { name: 'End Table', image: 'iconendtable.png' }
    ],
    store: [
        { name: 'Cabinet', image: 'cabinet.png' } // Placeholder
    ],
    bed: [
        { name: 'King Bed', image: 'iconbeds.png' } // Placeholder
    ]
};

/* --- INIT --- */
renderTrunkCategories();

/* --- RENDER TRUNK (Sidebar) --- */
function renderTrunkCategories() {
    const container = document.getElementById('trunk-items-container');
    container.innerHTML = '<h3 style="color:#d4af37; margin-bottom:10px;">Catalog</h3>';
    
    categories.forEach(cat => {
        const plate = document.createElement('div');
        plate.className = 'bronze-plate';
        plate.innerHTML = `<img src="${cat.icon}" class="plate-icon" onerror="this.src='iconseating.png'">`;
        
        plate.onclick = () => {
            // Highlight active
            document.querySelectorAll('.bronze-plate').forEach(p => p.classList.remove('active'));
            plate.classList.add('active');
            // Show Flyout
            showFlyout(cat.id);
        };
        
        container.appendChild(plate);
    });
}

/* --- RENDER FLYOUT (Side Stack) --- */
function showFlyout(catId) {
    const menu = document.getElementById('flyout-menu');
    menu.innerHTML = '';
    
    const items = inventory[catId];
    if(items && items.length > 0) {
        items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'flyout-item';
            div.innerHTML = `
                <img src="${item.image}" class="flyout-thumb" onerror="this.src='iconcouch.png'">
                <span>${item.name}</span>
            `;
            div.onclick = () => addToStage(item.image);
            menu.appendChild(div);
        });
        menu.classList.add('visible');
    } else {
        menu.classList.remove('visible');
    }
}

/* --- STAGE LOGIC --- */
function addToStage(imgSrc) {
    const stage = document.getElementById('main-stage-area');
    
    const wrapper = document.createElement('div');
    wrapper.className = 'stage-item-wrapper';
    wrapper.style.width = '150px'; 
    wrapper.style.height = '100px';
    wrapper.style.left = '200px'; // Places it nicely in view
    wrapper.style.top = '200px';
    
    const img = document.createElement('img');
    img.src = imgSrc;
    
    const handle = document.createElement('div');
    handle.className = 'resize-handle';
    
    wrapper.appendChild(img);
    wrapper.appendChild(handle);
    stage.appendChild(wrapper);
    
    makeDraggable(wrapper);
    makeResizable(wrapper, handle);
    
    // Select logic
    wrapper.onclick = (e) => {
        e.stopPropagation();
        document.querySelectorAll('.stage-item-wrapper').forEach(el => el.classList.remove('selected'));
        wrapper.classList.add('selected');
    };
    wrapper.ondblclick = () => wrapper.remove();
    
    // Hide menu after pick
    document.getElementById('flyout-menu').classList.remove('visible');
}

/* --- DRAG & RESIZE --- */
function makeDraggable(el) {
    let isDragging = false;
    let startX, startY, initialLeft, initialTop;
    el.onmousedown = function(e) {
        if(e.target.classList.contains('resize-handle')) return;
        isDragging = true;
        startX = e.clientX; startY = e.clientY;
        initialLeft = el.offsetLeft; initialTop = el.offsetTop;
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
    };
    function onMouseMove(e) {
        if (!isDragging) return;
        el.style.left = `${initialLeft + (e.clientX - startX)}px`;
        el.style.top = `${initialTop + (e.clientY - startY)}px`;
    }
    function onMouseUp() {
        isDragging = false;
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
    }
}

function makeResizable(el, handle) {
    let isResizing = false;
    let startX, startY, startW, startH;
    handle.onmousedown = function(e) {
        e.stopPropagation();
        isResizing = true;
        startX = e.clientX; startY = e.clientY;
        startW = el.offsetWidth; startH = el.offsetHeight;
        document.addEventListener('mousemove', onResizeMove);
        document.addEventListener('mouseup', onResizeUp);
    };
    function onResizeMove(e) {
        if (!isResizing) return;
        el.style.width = (startW + (e.clientX - startX)) + 'px';
        el.style.height = (startH + (e.clientY - startY)) + 'px';
    }
    function onResizeUp() {
        isResizing = false;
        document.removeEventListener('mousemove', onResizeMove);
        document.removeEventListener('mouseup', onResizeUp);
    }
}

/* --- ROOM LOGIC --- */
const roomData = {
    livingroom: ['livingroom.jpg'], bedroom: ['bedroom.jpg', 'bedroom2.jpg'], 
    diningroom: ['diningroom.jpg', 'diningroom1.jpg'], extrarooms: ['extrarooms.jpg', 'kitchen.jpg', 'foyer.jpg']
};
let currentCategory = ''; let currentIndex = 0; let isLocked = false;

function hoverRoom(category) { if (isLocked) return; currentCategory = category; currentIndex = 0; updateStage(); }
function nextVariation(category) {
    if (isLocked) { if(confirm("Unlock and change room?")) { unlockRoom(); } else { return; } }
    if (currentCategory !== category) { currentCategory = category; currentIndex = 0; } 
    else { if(roomData[category].length > 1) currentIndex = (currentIndex + 1) % roomData[category].length; }
    updateStage();
}
function updateStage() {
    const imgElement = document.getElementById('room-display');
    if(roomData[currentCategory]) { imgElement.src = roomData[currentCategory][currentIndex]; imgElement.style.display = 'block'; }
}

/* THE SWAP LOGIC */
function lockRoom() {
    const imgElement = document.getElementById('room-display');
    if (!imgElement.src || imgElement.style.display === 'none') return; 
    
    isLocked = true; 
    // Trigger the CSS Class to Swap Sidebar Panels
    document.body.classList.add('mode-furniture');
}

function unlockRoom() {
    isLocked = false;
    document.body.classList.remove('mode-furniture');
}

function triggerUpload() { document.getElementById('file-upload').click(); }
function handleFileUpload(event) {
    const file = event.target.files[0];
    if (file) {
        if(isLocked) unlockRoom();
        const reader = new FileReader();
        reader.onload = function(e) {
            const imgElement = document.getElementById('room-display');
            imgElement.src = e.target.result; imgElement.style.display = 'block';
        }
        reader.readAsDataURL(file);
    }
}
</script>
</body>
</html>
