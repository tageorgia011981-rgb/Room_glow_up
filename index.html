<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Manifest</title>
    <style>
        /* 110vh MASTER VIEWPORT */
        body, html { 
            margin: 0; padding: 0; height: 110vh; overflow: hidden; 
            background: #121212; font-family: sans-serif; 
        }

        /* FIXED HEADER */
        header { 
            position: fixed; top: 0; width: 100%; height: 60px; 
            background: #000; border-bottom: 1px solid #333; z-index: 9999; 
            display: flex; align-items: center; justify-content: center; 
        }

        .nav-tab { 
            color: white; padding: 0 25px; cursor: pointer; 
            text-transform: uppercase; font-size: 13px; letter-spacing: 2px;
        }

        /* CABINET (LEFT) */
        #furniture-cabinet { 
            position: absolute; left: 0; top: 60px; width: 30%; 
            height: calc(110vh - 60px); background: #222; 
            border-right: 1px solid #444; transition: transform 0.4s ease; z-index: 1000; 
        }

        /* STAGE (RIGHT) */
        #main-stage { 
            position: absolute; right: 0; top: 60px; width: 70%; 
            height: calc(110vh - 60px); background: #1a1a1a; perspective: 1200px; 
            overflow: hidden;
        }

        /* DECOR CLOSET (FLOATING) */
        #decor-closet { 
            display: none; position: fixed; right: 20px; top: 80px; 
            width: 300px; height: 75vh; background: #111; 
            border: 1px solid #444; z-index: 5000; padding: 20px; overflow-y: auto; 
            box-shadow: -10px 0 30px rgba(0,0,0,0.5);
        }

        .shelf-title {
            color: #888; font-size: 11px; letter-spacing: 1px;
            margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 5px;
        }

        /* SHELF ITEMS & "i" BUBBLE */
        .shelf-item-container { position: relative; margin-bottom: 20px; cursor: grab; }
        .shelf-item { width: 100%; display: block; }
        
        .hover-info { 
            position: absolute; bottom: 8px; right: 8px; background: #fff; 
            color: #000; width: 20px; height: 20px; border-radius: 50%; 
            text-align: center; font-size: 12px; line-height: 20px; 
            display: none; font-weight: bold; 
        }
        .shelf-item-container:hover .hover-info { display: block; }

        /* PLACED ON STAGE */
        .placed-asset { position: absolute; cursor: move; }
    </style>
</head>
<body>

    <header>
        <div class="nav-tab" onclick="toggleDecor(false)">Rooms</div>
        <div class="nav-tab" onclick="toggleDecor(true)">Decor</div>
    </header>

    <div id="furniture-cabinet">
        </div>

    <div id="main-stage">
        </div>

    <div id="decor-closet">
        <div class="shelf-title">DECOR CLOSET</div>
        
        <div class="shelf-item-container">
            <img src="Assets/decor/rug1.png" class="shelf-item" 
                 data-cat="rug" data-id="R-101" data-price="$299" data-link="buy.com/rug1" draggable="true">
            <div class="hover-info">i</div>
        </div>

        <div class="shelf-item-container">
            <img src="Assets/decor/lamp1.png" class="shelf-item" 
                 data-cat="lamp" data-id="L-201" data-price="$85" data-link="buy.com/lamp1" draggable="true">
            <div class="hover-info">i</div>
        </div>
    </div>

    <script>
        // THE SILENT DATA COLLECTOR
        let scrollReceiptData = {};

        // NAVIGATION: GLIDE CABINET & SHOW CLOSET
        function toggleDecor(show) {
            const closet = document.getElementById('decor-closet');
            const cabinet = document.getElementById('furniture-cabinet');
            
            if (show) {
                closet.style.display = "block";
                cabinet.style.transform = "translateX(-100%)";
            } else {
                closet.style.display = "none";
                cabinet.style.transform = "translateX(0)";
            }
        }

        // DRAG START
        document.addEventListener('dragstart', (e) => {
            if (e.target.classList.contains('shelf-item')) {
                const d = e.target.dataset;
                e.dataTransfer.setData('itemInfo', JSON.stringify({
                    src: e.target.src,
                    cat: d.cat,
                    id: d.id,
                    price: d.price,
                    link: d.link
                }));
            }
        });

        const stage = document.getElementById('main-stage');
        stage.addEventListener('dragover', (e) => e.preventDefault());

        // DROP & HOT SWAP LOGIC
        stage.addEventListener('drop', (e) => {
            e.preventDefault();
            const data = JSON.parse(e.dataTransfer.getData('itemInfo'));

            // 1. HOT SWAP (Visual Cleanup)
            const existing = stage.querySelector(`[data-cat="${data.cat}"]`);
            if (existing) existing.remove();

            // 2. PLACE ON STAGE
            const img = document.createElement('img');
            img.src = data.src;
            img.dataset.cat = data.cat;
            img.className = 'placed-asset';
            img.style.left = (e.clientX - stage.offsetLeft) + 'px';
            img.style.top = (e.clientY - stage.offsetTop) + 'px';

            // 3. RUG PIVOT (Flatten on Floor)
            if (data.cat === 'rug') {
                img.style.transform = "rotateX(75deg) scale(2.5)";
                img.style.zIndex = "5";
            } else {
                img.style.zIndex = "50";
            }

            stage.appendChild(img);

            // 4. UPDATE RECEIPT (Data Sync)
            scrollReceiptData[data.cat] = {
                id: data.id,
                price: data.price,
                link: data.link
            };
            
            console.log("Master Receipt Updated:", scrollReceiptData);
        });
    </script>
</body>
</html>
